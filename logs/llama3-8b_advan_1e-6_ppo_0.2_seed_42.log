nohup: ignoring input
[W1114 11:01:28.148943017 socket.cpp:755] [c10d] The client socket cannot be initialized to connect to [::ffff:127.0.0.1]:29500 (errno: 97 - Address family not supported by protocol).
⚙️  Running in WANDB offline mode
⚙️  Running in WANDB offline mode
⚙️  Running in WANDB offline mode
⚙️  Running in WANDB offline mode
设置随机种子为: 42
设置随机种子为: 42
设置随机种子为: 42
设置随机种子为: 42
从磁盘加载数据集 (注意: 数据集中不再需要 ref_logp)...
加载用于训练的策略模型 (Policy Model)...
从磁盘加载数据集 (注意: 数据集中不再需要 ref_logp)...
加载用于训练的策略模型 (Policy Model)...
从磁盘加载数据集 (注意: 数据集中不再需要 ref_logp)...
从磁盘加载数据集 (注意: 数据集中不再需要 ref_logp)...
加载用于训练的策略模型 (Policy Model)...
加载用于训练的策略模型 (Policy Model)...
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards: 100%|██████████| 4/4 [00:00<00:00, 94.74it/s]
加载作为参考的SFT模型 (Reference Model)...
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards: 100%|██████████| 4/4 [00:00<00:00, 97.54it/s]
加载作为参考的SFT模型 (Reference Model)...
Loading checkpoint shards: 100%|██████████| 4/4 [00:00<00:00, 95.45it/s]
Loading checkpoint shards: 100%|██████████| 4/4 [00:00<00:00, 92.90it/s]
加载作为参考的SFT模型 (Reference Model)...
加载作为参考的SFT模型 (Reference Model)...
Loading checkpoint shards: 100%|██████████| 4/4 [00:00<00:00, 95.31it/s]
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards: 100%|██████████| 4/4 [00:00<00:00, 98.94it/s]
Loading checkpoint shards: 100%|██████████| 4/4 [00:00<00:00, 94.51it/s]
Loading checkpoint shards: 100%|██████████| 4/4 [00:00<00:00, 93.43it/s]
[W1114 11:01:34.555255777 socket.cpp:755] [c10d] The client socket cannot be initialized to connect to [::ffff:127.0.0.1]:29500 (errno: 97 - Address family not supported by protocol).
[W1114 11:01:34.564339166 socket.cpp:755] [c10d] The client socket cannot be initialized to connect to [::ffff:127.0.0.1]:29500 (errno: 97 - Address family not supported by protocol).
[W1114 11:01:34.564606955 socket.cpp:755] [c10d] The client socket cannot be initialized to connect to [::ffff:127.0.0.1]:29500 (errno: 97 - Address family not supported by protocol).
[W1114 11:01:34.571570576 socket.cpp:755] [c10d] The client socket cannot be initialized to connect to [::ffff:127.0.0.1]:29500 (errno: 97 - Address family not supported by protocol).
初始化 CustomSymPOTrainer...
/rlhf_code/code/implement_final_v3_ppo.py:53: FutureWarning: `tokenizer` is deprecated and will be removed in version 5.0.0 for `CustomSymPOTrainer.__init__`. Use `processing_class` instead.
  super().__init__(model=model, args=args, **kwargs)
Detected kernel version 5.4.119, which is below the recommended minimum of 5.5.0; this can cause the process to hang. It is recommended to upgrade the kernel to the minimum version or higher.
初始化 CustomSymPOTrainer...
/rlhf_code/code/implement_final_v3_ppo.py:53: FutureWarning: `tokenizer` is deprecated and will be removed in version 5.0.0 for `CustomSymPOTrainer.__init__`. Use `processing_class` instead.
  super().__init__(model=model, args=args, **kwargs)
初始化 CustomSymPOTrainer...初始化 CustomSymPOTrainer...

/rlhf_code/code/implement_final_v3_ppo.py:53: FutureWarning: `tokenizer` is deprecated and will be removed in version 5.0.0 for `CustomSymPOTrainer.__init__`. Use `processing_class` instead.
  super().__init__(model=model, args=args, **kwargs)
/rlhf_code/code/implement_final_v3_ppo.py:53: FutureWarning: `tokenizer` is deprecated and will be removed in version 5.0.0 for `CustomSymPOTrainer.__init__`. Use `processing_class` instead.
  super().__init__(model=model, args=args, **kwargs)
/root/miniconda3/envs/advan/lib/python3.12/site-packages/pydantic/_internal/_generate_schema.py:2249: UnsupportedFieldAttributeWarning: The 'repr' attribute with value False was provided to the `Field()` function, which has no effect in the context it was used. 'repr' is field-specific metadata, and can only be attached to a model field using `Annotated` metadata or by assignment. This may have happened because an `Annotated` type alias using the `type` statement was used, or if the `Field()` function was attached to a single member of a union type.
  warnings.warn(
/root/miniconda3/envs/advan/lib/python3.12/site-packages/pydantic/_internal/_generate_schema.py:2249: UnsupportedFieldAttributeWarning: The 'frozen' attribute with value True was provided to the `Field()` function, which has no effect in the context it was used. 'frozen' is field-specific metadata, and can only be attached to a model field using `Annotated` metadata or by assignment. This may have happened because an `Annotated` type alias using the `type` statement was used, or if the `Field()` function was attached to a single member of a union type.
  warnings.warn(
/root/miniconda3/envs/advan/lib/python3.12/site-packages/pydantic/_internal/_generate_schema.py:2249: UnsupportedFieldAttributeWarning: The 'repr' attribute with value False was provided to the `Field()` function, which has no effect in the context it was used. 'repr' is field-specific metadata, and can only be attached to a model field using `Annotated` metadata or by assignment. This may have happened because an `Annotated` type alias using the `type` statement was used, or if the `Field()` function was attached to a single member of a union type.
  warnings.warn(
/root/miniconda3/envs/advan/lib/python3.12/site-packages/pydantic/_internal/_generate_schema.py:2249: UnsupportedFieldAttributeWarning: The 'frozen' attribute with value True was provided to the `Field()` function, which has no effect in the context it was used. 'frozen' is field-specific metadata, and can only be attached to a model field using `Annotated` metadata or by assignment. This may have happened because an `Annotated` type alias using the `type` statement was used, or if the `Field()` function was attached to a single member of a union type.
  warnings.warn(
/root/miniconda3/envs/advan/lib/python3.12/site-packages/pydantic/_internal/_generate_schema.py:2249: UnsupportedFieldAttributeWarning: The 'repr' attribute with value False was provided to the `Field()` function, which has no effect in the context it was used. 'repr' is field-specific metadata, and can only be attached to a model field using `Annotated` metadata or by assignment. This may have happened because an `Annotated` type alias using the `type` statement was used, or if the `Field()` function was attached to a single member of a union type.
  warnings.warn(
/root/miniconda3/envs/advan/lib/python3.12/site-packages/pydantic/_internal/_generate_schema.py:2249: UnsupportedFieldAttributeWarning: The 'frozen' attribute with value True was provided to the `Field()` function, which has no effect in the context it was used. 'frozen' is field-specific metadata, and can only be attached to a model field using `Annotated` metadata or by assignment. This may have happened because an `Annotated` type alias using the `type` statement was used, or if the `Field()` function was attached to a single member of a union type.
  warnings.warn(
/root/miniconda3/envs/advan/lib/python3.12/site-packages/pydantic/_internal/_generate_schema.py:2249: UnsupportedFieldAttributeWarning: The 'repr' attribute with value False was provided to the `Field()` function, which has no effect in the context it was used. 'repr' is field-specific metadata, and can only be attached to a model field using `Annotated` metadata or by assignment. This may have happened because an `Annotated` type alias using the `type` statement was used, or if the `Field()` function was attached to a single member of a union type.
  warnings.warn(
/root/miniconda3/envs/advan/lib/python3.12/site-packages/pydantic/_internal/_generate_schema.py:2249: UnsupportedFieldAttributeWarning: The 'frozen' attribute with value True was provided to the `Field()` function, which has no effect in the context it was used. 'frozen' is field-specific metadata, and can only be attached to a model field using `Annotated` metadata or by assignment. This may have happened because an `Annotated` type alias using the `type` statement was used, or if the `Field()` function was attached to a single member of a union type.
  warnings.warn(
Trainer.tokenizer is now deprecated. You should use Trainer.processing_class instead.
Trainer.tokenizer is now deprecated. You should use Trainer.processing_class instead.
Trainer.tokenizer is now deprecated. You should use Trainer.processing_class instead.
Trainer.tokenizer is now deprecated. You should use Trainer.processing_class instead.
开始分布式训练...
The tokenizer has new PAD/BOS/EOS tokens that differ from the model config and generation config. The model config and generation config were aligned accordingly, being updated with the tokenizer's values. Updated tokens: {'pad_token_id': 128009}.
开始分布式训练...
The tokenizer has new PAD/BOS/EOS tokens that differ from the model config and generation config. The model config and generation config were aligned accordingly, being updated with the tokenizer's values. Updated tokens: {'pad_token_id': 128009}.
开始分布式训练...
The tokenizer has new PAD/BOS/EOS tokens that differ from the model config and generation config. The model config and generation config were aligned accordingly, being updated with the tokenizer's values. Updated tokens: {'pad_token_id': 128009}.
开始分布式训练...
The tokenizer has new PAD/BOS/EOS tokens that differ from the model config and generation config. The model config and generation config were aligned accordingly, being updated with the tokenizer's values. Updated tokens: {'pad_token_id': 128009}.
/root/miniconda3/envs/advan/lib/python3.12/site-packages/accelerate/accelerator.py:1962: UserWarning: Upcasted low precision parameters in LlamaForCausalLM because mixed precision turned on in FSDP. Affects: model.embed_tokens.weight, model.norm.weight, lm_head.weight.
  warnings.warn(
/root/miniconda3/envs/advan/lib/python3.12/site-packages/accelerate/accelerator.py:1962: UserWarning: Upcasted low precision parameters in LlamaDecoderLayer because mixed precision turned on in FSDP. Affects: self_attn.q_proj.weight, self_attn.k_proj.weight, self_attn.v_proj.weight, self_attn.o_proj.weight, mlp.gate_proj.weight, mlp.up_proj.weight, mlp.down_proj.weight, input_layernorm.weight, post_attention_layernorm.weight.
  warnings.warn(
/root/miniconda3/envs/advan/lib/python3.12/site-packages/accelerate/accelerator.py:1968: UserWarning: FSDP upcast of low precision parameters may affect the precision of model checkpoints.
  warnings.warn(
wandb: Tracking run with wandb version 0.21.3
wandb: W&B syncing is set to `offline` in this directory. Run `wandb online` or set WANDB_MODE=online to enable cloud syncing.
wandb: Run data is saved locally in /root/wandb/offline-run-20251114_110142-ru5bducs
  0%|          | 0/3753 [00:00<?, ?it/s]Could not estimate the number of tokens of the input, floating-point operations will not be computed
Could not estimate the number of tokens of the input, floating-point operations will not be computed
Could not estimate the number of tokens of the input, floating-point operations will not be computed
Could not estimate the number of tokens of the input, floating-point operations will not be computed
  0%|          | 1/3753 [00:04<5:00:48,  4.81s/it]{'loss': -0.3989, 'grad_norm': 809.7926635742188, 'learning_rate': 0.0, 'mean_ratio_chosen': 3.7065606117248535, 'mean_ratio_rejected': 6.590037822723389, 'chosen_loss': -1.1063063144683838, 'rejected_loss': -0.05361704155802727, 'epoch': 0.0002664890073284477}
                                                  {'loss': -0.3989, 'grad_norm': 809.7926635742188, 'learning_rate': 0.0, 'mean_ratio_chosen': 3.7065606117248535, 'mean_ratio_rejected': 6.590037822723389, 'chosen_loss': -1.1063063144683838, 'rejected_loss': -0.05361704155802727, 'epoch': 0.0}
  0%|          | 1/3753 [00:04<5:00:48,  4.81s/it]  0%|          | 2/3753 [00:10<5:17:25,  5.08s/it]  0%|          | 3/3753 [00:14<5:06:51,  4.91s/it]  0%|          | 4/3753 [00:18<4:42:09,  4.52s/it]  0%|          | 5/3753 [00:22<4:33:20,  4.38s/it]  0%|          | 6/3753 [00:28<4:52:44,  4.69s/it]  0%|          | 7/3753 [00:32<4:41:33,  4.51s/it]  0%|          | 8/3753 [00:36<4:39:51,  4.48s/it]  0%|          | 9/3753 [00:40<4:22:18,  4.20s/it]  0%|          | 10/3753 [00:43<4:12:45,  4.05s/it]{'loss': -0.4952, 'grad_norm': 1669.9661865234375, 'learning_rate': 2.3936170212765956e-08, 'mean_ratio_chosen': 0.7894613146781921, 'mean_ratio_rejected': 1.0041897296905518, 'chosen_loss': -0.19348512589931488, 'rejected_loss': -0.41806623339653015, 'epoch': 0.002664890073284477}
                                                   {'loss': -0.4952, 'grad_norm': 1669.9661865234375, 'learning_rate': 2.3936170212765956e-08, 'mean_ratio_chosen': 0.7894613146781921, 'mean_ratio_rejected': 1.0041897296905518, 'chosen_loss': -0.19348512589931488, 'rejected_loss': -0.41806623339653015, 'epoch': 0.0}
  0%|          | 10/3753 [00:44<4:12:45,  4.05s/it]  0%|          | 11/3753 [00:48<4:20:23,  4.18s/it]  0%|          | 12/3753 [00:53<4:33:48,  4.39s/it]  0%|          | 13/3753 [00:57<4:32:03,  4.36s/it]  0%|          | 14/3753 [01:01<4:25:59,  4.27s/it]  0%|          | 15/3753 [01:05<4:16:01,  4.11s/it]  0%|          | 16/3753 [01:09<4:10:17,  4.02s/it]  0%|          | 17/3753 [01:12<4:04:30,  3.93s/it]  0%|          | 18/3753 [01:17<4:22:15,  4.21s/it]  1%|          | 19/3753 [01:21<4:05:49,  3.95s/it]  1%|          | 20/3753 [01:25<4:03:54,  3.92s/it]{'loss': -0.4767, 'grad_norm': 1546.717529296875, 'learning_rate': 5.053191489361702e-08, 'mean_ratio_chosen': 1.0139707326889038, 'mean_ratio_rejected': 1.6047028303146362, 'chosen_loss': -0.7428266406059265, 'rejected_loss': -0.3559851050376892, 'epoch': 0.005329780146568954}
                                                   {'loss': -0.4767, 'grad_norm': 1546.717529296875, 'learning_rate': 5.053191489361702e-08, 'mean_ratio_chosen': 1.0139707326889038, 'mean_ratio_rejected': 1.6047028303146362, 'chosen_loss': -0.7428266406059265, 'rejected_loss': -0.3559851050376892, 'epoch': 0.01}
  1%|          | 20/3753 [01:25<4:03:54,  3.92s/it]  1%|          | 21/3753 [01:29<4:06:22,  3.96s/it]  1%|          | 22/3753 [01:36<5:10:18,  4.99s/it]  1%|          | 23/3753 [01:41<5:09:29,  4.98s/it]  1%|          | 24/3753 [01:44<4:37:21,  4.46s/it]  1%|          | 25/3753 [01:48<4:32:20,  4.38s/it]  1%|          | 26/3753 [01:51<4:06:39,  3.97s/it]  1%|          | 27/3753 [01:55<4:06:43,  3.97s/it]  1%|          | 28/3753 [01:59<4:03:26,  3.92s/it]  1%|          | 29/3753 [02:03<4:01:13,  3.89s/it]  1%|          | 30/3753 [02:07<4:05:49,  3.96s/it]{'loss': -0.5655, 'grad_norm': 424.2532653808594, 'learning_rate': 7.712765957446808e-08, 'mean_ratio_chosen': 1.7900865077972412, 'mean_ratio_rejected': 2.0147838592529297, 'chosen_loss': -0.7535414695739746, 'rejected_loss': -0.7185378670692444, 'epoch': 0.007994670219853431}
                                                   {'loss': -0.5655, 'grad_norm': 424.2532653808594, 'learning_rate': 7.712765957446808e-08, 'mean_ratio_chosen': 1.7900865077972412, 'mean_ratio_rejected': 2.0147838592529297, 'chosen_loss': -0.7535414695739746, 'rejected_loss': -0.7185378670692444, 'epoch': 0.01}
  1%|          | 30/3753 [02:07<4:05:49,  3.96s/it]  1%|          | 31/3753 [02:12<4:28:41,  4.33s/it]  1%|          | 32/3753 [02:16<4:15:05,  4.11s/it]  1%|          | 33/3753 [02:19<4:04:55,  3.95s/it]  1%|          | 34/3753 [02:26<4:53:44,  4.74s/it]  1%|          | 35/3753 [02:32<5:08:51,  4.98s/it]  1%|          | 36/3753 [02:38<5:31:06,  5.34s/it]  1%|          | 37/3753 [02:43<5:37:18,  5.45s/it]  1%|          | 38/3753 [02:48<5:15:23,  5.09s/it]  1%|          | 39/3753 [02:56<6:07:27,  5.94s/it]  1%|          | 40/3753 [03:00<5:32:35,  5.37s/it]{'loss': -0.6634, 'grad_norm': 805.190185546875, 'learning_rate': 1.0372340425531915e-07, 'mean_ratio_chosen': 1.3579611778259277, 'mean_ratio_rejected': 2.059001922607422, 'chosen_loss': -0.9093533158302307, 'rejected_loss': -0.15318316221237183, 'epoch': 0.010659560293137908}
                                                   {'loss': -0.6634, 'grad_norm': 805.190185546875, 'learning_rate': 1.0372340425531915e-07, 'mean_ratio_chosen': 1.3579611778259277, 'mean_ratio_rejected': 2.059001922607422, 'chosen_loss': -0.9093533158302307, 'rejected_loss': -0.15318316221237183, 'epoch': 0.01}
  1%|          | 40/3753 [03:00<5:32:35,  5.37s/it]  1%|          | 41/3753 [03:06<5:53:57,  5.72s/it]  1%|          | 42/3753 [03:09<5:03:25,  4.91s/it]  1%|          | 43/3753 [03:14<5:00:12,  4.86s/it]  1%|          | 44/3753 [03:18<4:43:12,  4.58s/it]  1%|          | 45/3753 [03:23<4:48:02,  4.66s/it]  1%|          | 46/3753 [03:28<4:53:07,  4.74s/it]  1%|▏         | 47/3753 [03:31<4:19:08,  4.20s/it]  1%|▏         | 48/3753 [03:35<4:15:44,  4.14s/it]  1%|▏         | 49/3753 [03:39<4:18:08,  4.18s/it]  1%|▏         | 50/3753 [03:43<4:10:42,  4.06s/it]{'loss': -0.6246, 'grad_norm': 462.82275390625, 'learning_rate': 1.3031914893617022e-07, 'mean_ratio_chosen': 4.90418004989624, 'mean_ratio_rejected': 8.761743545532227, 'chosen_loss': -1.0360699892044067, 'rejected_loss': -0.8221288323402405, 'epoch': 0.013324450366422385}
                                                   {'loss': -0.6246, 'grad_norm': 462.82275390625, 'learning_rate': 1.3031914893617022e-07, 'mean_ratio_chosen': 4.90418004989624, 'mean_ratio_rejected': 8.761743545532227, 'chosen_loss': -1.0360699892044067, 'rejected_loss': -0.8221288323402405, 'epoch': 0.01}
  1%|▏         | 50/3753 [03:43<4:10:42,  4.06s/it]  1%|▏         | 51/3753 [03:47<4:11:29,  4.08s/it]  1%|▏         | 52/3753 [03:51<4:22:04,  4.25s/it]  1%|▏         | 53/3753 [03:57<4:50:43,  4.71s/it]  1%|▏         | 54/3753 [04:01<4:27:14,  4.33s/it]  1%|▏         | 55/3753 [04:08<5:29:02,  5.34s/it]  1%|▏         | 56/3753 [04:16<6:12:49,  6.05s/it]  2%|▏         | 57/3753 [04:21<5:47:23,  5.64s/it]  2%|▏         | 58/3753 [04:24<5:06:31,  4.98s/it]  2%|▏         | 59/3753 [04:32<5:53:45,  5.75s/it]  2%|▏         | 60/3753 [04:35<5:05:07,  4.96s/it]{'loss': -0.6306, 'grad_norm': 0.0, 'learning_rate': 1.5691489361702126e-07, 'mean_ratio_chosen': 6.877669811248779, 'mean_ratio_rejected': 8.683582305908203, 'chosen_loss': -0.036257531493902206, 'rejected_loss': -1.1246529817581177, 'epoch': 0.015989340439706862}
                                                   {'loss': -0.6306, 'grad_norm': 0.0, 'learning_rate': 1.5691489361702126e-07, 'mean_ratio_chosen': 6.877669811248779, 'mean_ratio_rejected': 8.683582305908203, 'chosen_loss': -0.036257531493902206, 'rejected_loss': -1.1246529817581177, 'epoch': 0.02}
  2%|▏         | 60/3753 [04:35<5:05:07,  4.96s/it]  2%|▏         | 61/3753 [04:40<5:12:04,  5.07s/it]  2%|▏         | 62/3753 [04:44<4:57:19,  4.83s/it]  2%|▏         | 63/3753 [04:49<4:49:28,  4.71s/it]  2%|▏         | 64/3753 [04:54<4:57:54,  4.85s/it]  2%|▏         | 65/3753 [04:58<4:40:07,  4.56s/it]  2%|▏         | 66/3753 [05:03<4:45:36,  4.65s/it]  2%|▏         | 67/3753 [05:07<4:42:21,  4.60s/it]  2%|▏         | 68/3753 [05:11<4:25:36,  4.32s/it]  2%|▏         | 69/3753 [05:15<4:29:04,  4.38s/it]  2%|▏         | 70/3753 [05:19<4:15:51,  4.17s/it]{'loss': -0.6623, 'grad_norm': 0.0, 'learning_rate': 1.8351063829787234e-07, 'mean_ratio_chosen': 278.91021728515625, 'mean_ratio_rejected': 47.816490173339844, 'chosen_loss': -1.1558767557144165, 'rejected_loss': -0.05361704155802727, 'epoch': 0.018654230512991338}
                                                   {'loss': -0.6623, 'grad_norm': 0.0, 'learning_rate': 1.8351063829787234e-07, 'mean_ratio_chosen': 278.91021728515625, 'mean_ratio_rejected': 47.816490173339844, 'chosen_loss': -1.1558767557144165, 'rejected_loss': -0.05361704155802727, 'epoch': 0.02}
  2%|▏         | 70/3753 [05:19<4:15:51,  4.17s/it]  2%|▏         | 71/3753 [05:24<4:25:49,  4.33s/it]  2%|▏         | 72/3753 [05:28<4:28:50,  4.38s/it]  2%|▏         | 73/3753 [05:32<4:16:55,  4.19s/it]  2%|▏         | 74/3753 [05:36<4:08:00,  4.04s/it]  2%|▏         | 75/3753 [05:39<4:00:16,  3.92s/it]  2%|▏         | 76/3753 [05:45<4:32:02,  4.44s/it]  2%|▏         | 77/3753 [05:48<4:08:31,  4.06s/it]  2%|▏         | 78/3753 [05:53<4:24:32,  4.32s/it]  2%|▏         | 79/3753 [05:57<4:23:54,  4.31s/it]  2%|▏         | 80/3753 [06:02<4:33:11,  4.46s/it]{'loss': -0.6147, 'grad_norm': 0.0, 'learning_rate': 2.101063829787234e-07, 'mean_ratio_chosen': 84787.25, 'mean_ratio_rejected': 250.0936279296875, 'chosen_loss': -1.1140905618667603, 'rejected_loss': -0.12276566028594971, 'epoch': 0.021319120586275817}
                                                   {'loss': -0.6147, 'grad_norm': 0.0, 'learning_rate': 2.101063829787234e-07, 'mean_ratio_chosen': 84787.25, 'mean_ratio_rejected': 250.0936279296875, 'chosen_loss': -1.1140905618667603, 'rejected_loss': -0.12276566028594971, 'epoch': 0.02}
  2%|▏         | 80/3753 [06:02<4:33:11,  4.46s/it]  2%|▏         | 81/3753 [06:07<4:37:29,  4.53s/it]  2%|▏         | 82/3753 [06:11<4:23:40,  4.31s/it]  2%|▏         | 83/3753 [06:17<5:05:46,  5.00s/it]  2%|▏         | 84/3753 [06:22<4:59:28,  4.90s/it]  2%|▏         | 85/3753 [06:26<4:33:33,  4.47s/it]  2%|▏         | 86/3753 [06:29<4:12:54,  4.14s/it]  2%|▏         | 87/3753 [06:36<5:03:15,  4.96s/it]  2%|▏         | 88/3753 [06:40<4:41:21,  4.61s/it]  2%|▏         | 89/3753 [06:44<4:34:35,  4.50s/it]  2%|▏         | 90/3753 [06:48<4:25:38,  4.35s/it]{'loss': -0.6989, 'grad_norm': 0.0, 'learning_rate': 2.3670212765957445e-07, 'mean_ratio_chosen': 359.8917236328125, 'mean_ratio_rejected': 3836.747802734375, 'chosen_loss': -0.9470804333686829, 'rejected_loss': -0.1800345778465271, 'epoch': 0.023984010659560292}
                                                   {'loss': -0.6989, 'grad_norm': 0.0, 'learning_rate': 2.3670212765957445e-07, 'mean_ratio_chosen': 359.8917236328125, 'mean_ratio_rejected': 3836.747802734375, 'chosen_loss': -0.9470804333686829, 'rejected_loss': -0.1800345778465271, 'epoch': 0.02}
  2%|▏         | 90/3753 [06:48<4:25:38,  4.35s/it]  2%|▏         | 91/3753 [06:51<4:06:13,  4.03s/it]  2%|▏         | 92/3753 [06:55<4:04:13,  4.00s/it]  2%|▏         | 93/3753 [07:01<4:32:11,  4.46s/it]  3%|▎         | 94/3753 [07:04<4:20:55,  4.28s/it]  3%|▎         | 95/3753 [07:11<5:01:08,  4.94s/it]  3%|▎         | 96/3753 [07:15<4:43:52,  4.66s/it]  3%|▎         | 97/3753 [07:19<4:35:44,  4.53s/it]  3%|▎         | 98/3753 [07:25<4:57:53,  4.89s/it]  3%|▎         | 99/3753 [07:28<4:31:02,  4.45s/it]  3%|▎         | 100/3753 [07:32<4:15:58,  4.20s/it]{'loss': -0.6724, 'grad_norm': 0.0, 'learning_rate': 2.632978723404255e-07, 'mean_ratio_chosen': 69.45378875732422, 'mean_ratio_rejected': 102.25834655761719, 'chosen_loss': -0.7535414695739746, 'rejected_loss': -0.17297863960266113, 'epoch': 0.02664890073284477}
                                                    {'loss': -0.6724, 'grad_norm': 0.0, 'learning_rate': 2.632978723404255e-07, 'mean_ratio_chosen': 69.45378875732422, 'mean_ratio_rejected': 102.25834655761719, 'chosen_loss': -0.7535414695739746, 'rejected_loss': -0.17297863960266113, 'epoch': 0.03}
  3%|▎         | 100/3753 [07:32<4:15:58,  4.20s/it]/root/miniconda3/envs/advan/lib/python3.12/site-packages/torch/distributed/fsdp/fully_sharded_data_parallel.py:678: FutureWarning: FSDP.state_dict_type() and FSDP.set_state_dict_type() are being deprecated. Please use APIs, get_state_dict() and set_state_dict(), which can support different parallelisms, FSDP1, FSDP2, DDP. API doc: https://pytorch.org/docs/stable/distributed.checkpoint.html#torch.distributed.checkpoint.state_dict.get_state_dict .Tutorial: https://pytorch.org/tutorials/recipes/distributed_checkpoint_recipe.html .
  warnings.warn(
/root/miniconda3/envs/advan/lib/python3.12/site-packages/torch/distributed/fsdp/fully_sharded_data_parallel.py:678: FutureWarning: FSDP.state_dict_type() and FSDP.set_state_dict_type() are being deprecated. Please use APIs, get_state_dict() and set_state_dict(), which can support different parallelisms, FSDP1, FSDP2, DDP. API doc: https://pytorch.org/docs/stable/distributed.checkpoint.html#torch.distributed.checkpoint.state_dict.get_state_dict .Tutorial: https://pytorch.org/tutorials/recipes/distributed_checkpoint_recipe.html .
  warnings.warn(
/root/miniconda3/envs/advan/lib/python3.12/site-packages/torch/distributed/fsdp/fully_sharded_data_parallel.py:678: FutureWarning: FSDP.state_dict_type() and FSDP.set_state_dict_type() are being deprecated. Please use APIs, get_state_dict() and set_state_dict(), which can support different parallelisms, FSDP1, FSDP2, DDP. API doc: https://pytorch.org/docs/stable/distributed.checkpoint.html#torch.distributed.checkpoint.state_dict.get_state_dict .Tutorial: https://pytorch.org/tutorials/recipes/distributed_checkpoint_recipe.html .
  warnings.warn(
/root/miniconda3/envs/advan/lib/python3.12/site-packages/torch/distributed/fsdp/fully_sharded_data_parallel.py:678: FutureWarning: FSDP.state_dict_type() and FSDP.set_state_dict_type() are being deprecated. Please use APIs, get_state_dict() and set_state_dict(), which can support different parallelisms, FSDP1, FSDP2, DDP. API doc: https://pytorch.org/docs/stable/distributed.checkpoint.html#torch.distributed.checkpoint.state_dict.get_state_dict .Tutorial: https://pytorch.org/tutorials/recipes/distributed_checkpoint_recipe.html .
  warnings.warn(
/root/miniconda3/envs/advan/lib/python3.12/site-packages/torch/distributed/distributed_c10d.py:860: UserWarning: `_get_pg_default_device` will be deprecated, it only stays for backward-compatiblity reason. If you need to find a device for object collectives, please use `_get_object_coll_device`. If you need to query the device types supported by group, please use `_device_capability(group)`. 
  warnings.warn(
/root/miniconda3/envs/advan/lib/python3.12/site-packages/torch/distributed/distributed_c10d.py:860: UserWarning: `_get_pg_default_device` will be deprecated, it only stays for backward-compatiblity reason. If you need to find a device for object collectives, please use `_get_object_coll_device`. If you need to query the device types supported by group, please use `_device_capability(group)`. 
  warnings.warn(
/root/miniconda3/envs/advan/lib/python3.12/site-packages/torch/distributed/distributed_c10d.py:860: UserWarning: `_get_pg_default_device` will be deprecated, it only stays for backward-compatiblity reason. If you need to find a device for object collectives, please use `_get_object_coll_device`. If you need to query the device types supported by group, please use `_device_capability(group)`. 
  warnings.warn(
/root/miniconda3/envs/advan/lib/python3.12/site-packages/torch/distributed/distributed_c10d.py:860: UserWarning: `_get_pg_default_device` will be deprecated, it only stays for backward-compatiblity reason. If you need to find a device for object collectives, please use `_get_object_coll_device`. If you need to query the device types supported by group, please use `_device_capability(group)`. 
  warnings.warn(
/root/miniconda3/envs/advan/lib/python3.12/site-packages/torch/distributed/fsdp/_state_dict_utils.py:722: FutureWarning: Please use DTensor instead and we are deprecating ShardedTensor.
  local_shape = tensor.shape
/root/miniconda3/envs/advan/lib/python3.12/site-packages/torch/distributed/fsdp/_state_dict_utils.py:739: FutureWarning: Please use DTensor instead and we are deprecating ShardedTensor.
  tensor.shape,
/root/miniconda3/envs/advan/lib/python3.12/site-packages/torch/distributed/fsdp/_state_dict_utils.py:741: FutureWarning: Please use DTensor instead and we are deprecating ShardedTensor.
  tensor.dtype,
/root/miniconda3/envs/advan/lib/python3.12/site-packages/torch/distributed/fsdp/_state_dict_utils.py:722: FutureWarning: Please use DTensor instead and we are deprecating ShardedTensor.
  local_shape = tensor.shape
/root/miniconda3/envs/advan/lib/python3.12/site-packages/torch/distributed/fsdp/_state_dict_utils.py:739: FutureWarning: Please use DTensor instead and we are deprecating ShardedTensor.
  tensor.shape,
/root/miniconda3/envs/advan/lib/python3.12/site-packages/torch/distributed/fsdp/_state_dict_utils.py:741: FutureWarning: Please use DTensor instead and we are deprecating ShardedTensor.
  tensor.dtype,
/root/miniconda3/envs/advan/lib/python3.12/site-packages/torch/distributed/fsdp/_state_dict_utils.py:722: FutureWarning: Please use DTensor instead and we are deprecating ShardedTensor.
  local_shape = tensor.shape
/root/miniconda3/envs/advan/lib/python3.12/site-packages/torch/distributed/fsdp/_state_dict_utils.py:739: FutureWarning: Please use DTensor instead and we are deprecating ShardedTensor.
  tensor.shape,
/root/miniconda3/envs/advan/lib/python3.12/site-packages/torch/distributed/fsdp/_state_dict_utils.py:722: FutureWarning: Please use DTensor instead and we are deprecating ShardedTensor.
  local_shape = tensor.shape
/root/miniconda3/envs/advan/lib/python3.12/site-packages/torch/distributed/fsdp/_state_dict_utils.py:741: FutureWarning: Please use DTensor instead and we are deprecating ShardedTensor.
  tensor.dtype,
/root/miniconda3/envs/advan/lib/python3.12/site-packages/torch/distributed/fsdp/_state_dict_utils.py:739: FutureWarning: Please use DTensor instead and we are deprecating ShardedTensor.
  tensor.shape,
/root/miniconda3/envs/advan/lib/python3.12/site-packages/torch/distributed/fsdp/_state_dict_utils.py:741: FutureWarning: Please use DTensor instead and we are deprecating ShardedTensor.
  tensor.dtype,
  3%|▎         | 101/3753 [08:30<20:31:59, 20.24s/it]  3%|▎         | 102/3753 [08:34<15:36:48, 15.40s/it]  3%|▎         | 103/3753 [08:37<12:05:30, 11.93s/it]  3%|▎         | 104/3753 [08:43<10:11:06, 10.05s/it]  3%|▎         | 105/3753 [08:47<8:20:12,  8.23s/it]   3%|▎         | 106/3753 [08:52<7:24:11,  7.31s/it]  3%|▎         | 107/3753 [08:57<6:37:03,  6.53s/it]  3%|▎         | 108/3753 [09:01<5:52:28,  5.80s/it]  3%|▎         | 109/3753 [09:05<5:17:46,  5.23s/it]  3%|▎         | 110/3753 [09:09<4:53:36,  4.84s/it]{'loss': -0.6426, 'grad_norm': 0.0, 'learning_rate': 2.8989361702127657e-07, 'mean_ratio_chosen': 64398.48828125, 'mean_ratio_rejected': 205.9884033203125, 'chosen_loss': -1.0964118242263794, 'rejected_loss': -0.04975472390651703, 'epoch': 0.029313790806129246}
                                                    {'loss': -0.6426, 'grad_norm': 0.0, 'learning_rate': 2.8989361702127657e-07, 'mean_ratio_chosen': 64398.48828125, 'mean_ratio_rejected': 205.9884033203125, 'chosen_loss': -1.0964118242263794, 'rejected_loss': -0.04975472390651703, 'epoch': 0.03}
  3%|▎         | 110/3753 [09:09<4:53:36,  4.84s/it]  3%|▎         | 111/3753 [09:14<4:59:26,  4.93s/it]  3%|▎         | 112/3753 [09:18<4:37:16,  4.57s/it]  3%|▎         | 113/3753 [09:21<4:13:56,  4.19s/it]  3%|▎         | 114/3753 [09:25<4:04:35,  4.03s/it]  3%|▎         | 115/3753 [09:29<4:00:04,  3.96s/it]  3%|▎         | 116/3753 [09:33<4:07:26,  4.08s/it]  3%|▎         | 117/3753 [09:37<4:02:29,  4.00s/it]  3%|▎         | 118/3753 [09:41<4:13:04,  4.18s/it]  3%|▎         | 119/3753 [09:49<5:14:28,  5.19s/it]  3%|▎         | 120/3753 [09:53<5:02:31,  5.00s/it]{'loss': -0.6936, 'grad_norm': 0.0, 'learning_rate': 3.1648936170212764e-07, 'mean_ratio_chosen': 2843.75537109375, 'mean_ratio_rejected': 22.00417709350586, 'chosen_loss': -1.0038654804229736, 'rejected_loss': -0.5940309762954712, 'epoch': 0.031978680879413725}
                                                    {'loss': -0.6936, 'grad_norm': 0.0, 'learning_rate': 3.1648936170212764e-07, 'mean_ratio_chosen': 2843.75537109375, 'mean_ratio_rejected': 22.00417709350586, 'chosen_loss': -1.0038654804229736, 'rejected_loss': -0.5940309762954712, 'epoch': 0.03}
  3%|▎         | 120/3753 [09:54<5:02:31,  5.00s/it]  3%|▎         | 121/3753 [09:58<4:51:31,  4.82s/it]  3%|▎         | 122/3753 [10:02<4:44:42,  4.70s/it]  3%|▎         | 123/3753 [10:07<4:40:04,  4.63s/it]  3%|▎         | 124/3753 [10:11<4:24:23,  4.37s/it]  3%|▎         | 125/3753 [10:15<4:32:18,  4.50s/it]  3%|▎         | 126/3753 [10:20<4:36:19,  4.57s/it]  3%|▎         | 127/3753 [10:24<4:18:43,  4.28s/it]  3%|▎         | 128/3753 [10:28<4:19:25,  4.29s/it]  3%|▎         | 129/3753 [10:34<4:46:25,  4.74s/it]  3%|▎         | 130/3753 [10:38<4:44:36,  4.71s/it]{'loss': -0.6587, 'grad_norm': 0.0, 'learning_rate': 3.430851063829787e-07, 'mean_ratio_chosen': 80.98687744140625, 'mean_ratio_rejected': 10286.173828125, 'chosen_loss': -0.3569639027118683, 'rejected_loss': -0.13164694607257843, 'epoch': 0.034643570952698204}
                                                    {'loss': -0.6587, 'grad_norm': 0.0, 'learning_rate': 3.430851063829787e-07, 'mean_ratio_chosen': 80.98687744140625, 'mean_ratio_rejected': 10286.173828125, 'chosen_loss': -0.3569639027118683, 'rejected_loss': -0.13164694607257843, 'epoch': 0.03}
  3%|▎         | 130/3753 [10:39<4:44:36,  4.71s/it]  3%|▎         | 131/3753 [10:42<4:29:38,  4.47s/it]  4%|▎         | 132/3753 [10:46<4:07:59,  4.11s/it]  4%|▎         | 133/3753 [10:50<4:15:15,  4.23s/it]  4%|▎         | 134/3753 [10:55<4:19:27,  4.30s/it]  4%|▎         | 135/3753 [10:58<4:08:44,  4.12s/it]  4%|▎         | 136/3753 [11:02<3:58:56,  3.96s/it]  4%|▎         | 137/3753 [11:06<3:54:05,  3.88s/it]  4%|▎         | 138/3753 [11:10<4:04:44,  4.06s/it]  4%|▎         | 139/3753 [11:14<3:57:53,  3.95s/it]  4%|▎         | 140/3753 [11:19<4:12:56,  4.20s/it]{'loss': -0.6276, 'grad_norm': 0.0, 'learning_rate': 3.696808510638298e-07, 'mean_ratio_chosen': 111.04444122314453, 'mean_ratio_rejected': 46.55229187011719, 'chosen_loss': -1.0315965414047241, 'rejected_loss': -0.17647741734981537, 'epoch': 0.037308461025982675}
                                                    {'loss': -0.6276, 'grad_norm': 0.0, 'learning_rate': 3.696808510638298e-07, 'mean_ratio_chosen': 111.04444122314453, 'mean_ratio_rejected': 46.55229187011719, 'chosen_loss': -1.0315965414047241, 'rejected_loss': -0.17647741734981537, 'epoch': 0.04}
  4%|▎         | 140/3753 [11:19<4:12:56,  4.20s/it]  4%|▍         | 141/3753 [11:22<4:05:53,  4.08s/it]  4%|▍         | 142/3753 [11:29<4:51:59,  4.85s/it]  4%|▍         | 143/3753 [11:33<4:37:56,  4.62s/it]  4%|▍         | 144/3753 [11:39<4:54:55,  4.90s/it]  4%|▍         | 145/3753 [11:46<5:35:09,  5.57s/it]  4%|▍         | 146/3753 [11:51<5:26:50,  5.44s/it]  4%|▍         | 147/3753 [11:58<5:55:08,  5.91s/it]  4%|▍         | 148/3753 [12:03<5:39:28,  5.65s/it]  4%|▍         | 149/3753 [12:07<5:05:47,  5.09s/it]  4%|▍         | 150/3753 [12:13<5:34:50,  5.58s/it]{'loss': -0.6884, 'grad_norm': 0.0, 'learning_rate': 3.962765957446808e-07, 'mean_ratio_chosen': 20.53488540649414, 'mean_ratio_rejected': 56.0534782409668, 'chosen_loss': -0.40255168080329895, 'rejected_loss': -0.7083684206008911, 'epoch': 0.039973351099267154}
                                                    {'loss': -0.6884, 'grad_norm': 0.0, 'learning_rate': 3.962765957446808e-07, 'mean_ratio_chosen': 20.53488540649414, 'mean_ratio_rejected': 56.0534782409668, 'chosen_loss': -0.40255168080329895, 'rejected_loss': -0.7083684206008911, 'epoch': 0.04}
  4%|▍         | 150/3753 [12:14<5:34:50,  5.58s/it]  4%|▍         | 151/3753 [12:19<5:31:32,  5.52s/it]  4%|▍         | 152/3753 [12:23<5:01:49,  5.03s/it]  4%|▍         | 153/3753 [12:28<4:58:32,  4.98s/it]  4%|▍         | 154/3753 [12:32<4:46:43,  4.78s/it]  4%|▍         | 155/3753 [12:36<4:33:16,  4.56s/it]  4%|▍         | 156/3753 [12:40<4:25:26,  4.43s/it]  4%|▍         | 157/3753 [12:44<4:17:26,  4.30s/it]  4%|▍         | 158/3753 [12:49<4:25:19,  4.43s/it]  4%|▍         | 159/3753 [12:53<4:20:06,  4.34s/it]  4%|▍         | 160/3753 [12:57<4:24:39,  4.42s/it]{'loss': -0.6818, 'grad_norm': 0.0, 'learning_rate': 4.228723404255319e-07, 'mean_ratio_chosen': 8575.818359375, 'mean_ratio_rejected': 56.06117630004883, 'chosen_loss': -0.8160351514816284, 'rejected_loss': -0.404644250869751, 'epoch': 0.04263824117255163}
                                                    {'loss': -0.6818, 'grad_norm': 0.0, 'learning_rate': 4.228723404255319e-07, 'mean_ratio_chosen': 8575.818359375, 'mean_ratio_rejected': 56.06117630004883, 'chosen_loss': -0.8160351514816284, 'rejected_loss': -0.404644250869751, 'epoch': 0.04}
  4%|▍         | 160/3753 [12:58<4:24:39,  4.42s/it]